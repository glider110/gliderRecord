### 工程代码bug汇总

×××××××××××××××××××××××××××××××××××××××××××××××××××××××××××××××××××××××××××××××××××××××××××××××××

- 编译问题：编译-链接-运行 三阶段

  答：。。。

- bug记录：耗时问题 标准版本250ms以内 测试远远大于  

  答：log_workspace开启、实时显示通讯传输、keyword获取等待

- 融合地图：融合后有数据，机器确不避障

  答：和路径规划那边接口了解不清楚 还有其他参数没有设置
  
- 融合地图：融合后有数据，机器确不显示

  答：数据没有清除；在类初始化而没在函数里面去除数据

- 外参标定：R随场景不一样有部分变化，T和实测很大；

  可能原因：误差引入太多 1.pitch角度 2.机身旋转和相机旋转的区别 3.世界坐标系的定义位置 4.标定画幅 5.对应的内参是否匹配 

  ​											6.标定距离		

- 推库失败：推入so后机器不能启动，通信失败；

  答：1.新interface和旧的tof不匹配 没有地毯检测功能，版本不一致

  ​		2.开发板Linux裁剪后的通信机制和pc不一样，要重启后才启动通信；

- 线检测区域判定优化：墙角环境和黑色椅子场景；

  答：1.tof通病 墙角
  
  ​		2.高度恰好挡住后面点云，统计不到区域点云；

- log分析：分级打印失败

  答：变量为bool -3转为1 0转0  改为int型分级
  
- 编译问题：声明了新添加的函数，编译不通过

  答：大项目多文件情况下 底层的头文件往上传可能导致 改动的底层头文件 而上层编译还用的未修改的头文件；

- 语法问题：初始化coredump；

  答：指针地址没有new；（习惯好：对象老是记不住给地址和清地址）

- 语法问题：实时避障检测出来的grid数据不对，出现一系列的粉色区域和单个粉色点。

  ```c++
  AKTOF::TofGridData *obstacle_map=new(AKTOF::TofGridData);
  AKTOF::ClearGridData(*obstacle_map);
  // delete obstacle_map;
  ```

  

### **调试分析实战案例**

×××××××××××××××××××××××××××××××××××××××××××××××××××××××××××××××××××××××××××××××××××××××××××××××××

- 调试技巧：二分法定位问题   sleep(1000)
- 调试技巧：打印中间变量


```c++
   // TODO: 存在显示闪退bug 定位到下面这句函数
    // aktof.ExtractObstacles(convIrImg, clusters, output_grid, isRotation);
    aktof.ExtractObstacles(convIrImg, clusters, output_grid_generalobs,
                           isRotation);
    output_grid_generalobs.timestamp = tmp_tof_data.timestamp;
    output_grid = output_grid_generalobs;
    int count_c = 0;
    for (size_t i = 0; i < 100; ++i)
        {
            for (size_t j = 0; j < 100; ++j)
            {
                if (output_grid_generalobs.grid[i][j].type != 0)count_c++;
            }
        }   
    std::cout<<"CHW::count_c = "<<count_c<<std::endl;
```

- 调试技巧：实时输出难以观观察 追加到txt文件分析  ctrl+F     grep+“ “

- 调试技巧：ls -rtlh函数查看新文件  md5sum

- 解决繁琐调试：1.经常要用的有必要编写自动化脚本；2.要用的文件和复杂命令备份 3.关键想好测试验证流程

  ​                           ==测试过程中很多不可控，会出现很多幺蛾子，先牟定而后动；==







### 思路汇总

××××××××××××××××××××××××××××××××××××××××××××××××××××××××××××××××××××××××××××××××××××××××××××××××××××××××××××××××××××××××××

- 关于类**初始化**：大型工程中 总初始化是一层包一层的初始化完了才执行其他操作   init(param p,ofstream log)

- 关于调试流程:目的 流程 操作 分析 结论 ps：不要为了测试而测试

- 报错 别慌 看报错的地方 1.编译报错（为获取文件和链接错误ld )    ld出现在后面 是链接库文件出错 其他大概率是源文件出错

  ​									 	2.coredump

- 但凡你想得到的功能，都有人开发过了；（建兴）
- git学习：系统的学  虽然记不到git命令 都有思路组织关键词搜索；还有就是理解这个工具解决什么问题；

